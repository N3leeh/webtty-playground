---
# file: hardening-ssh.yml

- name: Disable XForwarding
  ansible.builtin.lineinfile: 
    path: /etc/ssh/sshd_config
    regexp: "^#?X11Forwarding "
    line: "X11Forwarding no"
    state: present
  notify: restart sshd

- name: MaxAuthTries 6
  ansible.builtin.lineinfile: 
    path: /etc/ssh/sshd_config
    regexp: "^#?MaxAuthTries "
    line: "MaxAuthTries 6"
    state: present
  notify: restart sshd

- name: MaxSessions 10
  ansible.builtin.lineinfile: 
    path: /etc/ssh/sshd_config
    regexp: "^#?MaxSessions "
    line: "MaxSessions 10"
    state: present
  notify: restart sshd

- name: LoginGraceTime 1m
  ansible.builtin.lineinfile: 
    path: /etc/ssh/sshd_config
    regexp: "^#?LoginGraceTime "
    line: "LoginGraceTime 1m"
    state: present
  notify: restart sshd

- name: Copy Banner
  ansible.builtin.copy:
    src: files/issue.net
    dest: /etc/issue.net
    owner: root
    group: root
    mode: '0644'
  notify: restart sshd

- name: Setup Banner
  ansible.builtin.lineinfile: 
    path: /etc/ssh/sshd_config
    regexp: "^#?Banner "
    line: "Banner /etc/issue.net"
    state: present
  notify: restart sshd