---
# file: remove-groups.yml

- name: Lookup user data
  user:
    name: "{{ item }}"
    state: present
  register: user_data

- name: remove {{ item }} user from docker group
  command: "gpasswd -d {{ item }} docker"
  when: user_data.groups is defined and 'docker' in user_data.groups

- name: remove {{ item }} user from sudo group
  command: "gpasswd -d {{ item }} sudo"
  when: user_data.groups is defined and 'sudo' in user_data.groups